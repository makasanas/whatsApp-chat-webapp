<!-- <div class="flex align-items-center justify-content-end">
  <button class="btn" (click)="syncProduct()">
    <span>Sync Product</span>
  </button>
</div> -->

<form [formGroup]="filters" class="search-bar with-select">
  <div class="select">
    <select formControlName="type">
      <option value="all">All</option>
      <option *ngFor="let productType of producttypes" value="{{productType}}">{{productType}}</option>
    </select>
    <div class="icon"><svg xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink" height="451.847px"
        id="Capa_1" style="enable-background:new 0 0 451.847 451.847;" version="1.1" viewBox="0 0 451.847 451.847"
        width="451.847px" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px">
        <g>
          <path d="M225.923,354.706c-8.098,0-16.195-3.092-22.369-9.263L9.27,151.157c-12.359-12.359-12.359-32.397,0-44.751
      c12.354-12.354,32.388-12.354,44.748,0l171.905,171.915l171.906-171.909c12.359-12.354,32.391-12.354,44.744,0
      c12.365,12.354,12.365,32.392,0,44.751L248.292,345.449C242.115,351.621,234.018,354.706,225.923,354.706z"></path>
        </g>
      </svg>
    </div>
  </div>
  <div class="input">
    <input type="text" formControlName="text">
  </div>
  <div class="button" (click)="filter();">
    <div class="icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1"
        x="0px" y="0px" viewBox="0 0 56.966 56.966" style="enable-background:new 0 0 56.966 56.966;"
        xml:space="preserve">
        <path
          d="M55.146,51.887L41.588,37.786c3.486-4.144,5.396-9.358,5.396-14.786c0-12.682-10.318-23-23-23s-23,10.318-23,23  s10.318,23,23,23c4.761,0,9.298-1.436,13.177-4.162l13.661,14.208c0.571,0.593,1.339,0.92,2.162,0.92  c0.779,0,1.518-0.297,2.079-0.837C56.255,54.982,56.293,53.08,55.146,51.887z M23.984,6c9.374,0,17,7.626,17,17s-7.626,17-17,17  s-17-7.626-17-17S14.61,6,23.984,6z" />
      </svg>
    </div>
    <div class="text">
      <span>Search</span>
    </div>
  </div>
</form>

<div class="content">
  <div class="table-responsive" *ngIf="products.length != 0 && !loading">
    <ngx-datatable class="material new-styled" [rows]="products" [rowClass]="getRowClass" [columns]="columns"
      [headerHeight]="50" [footerHeight]="50" [externalPaging]="true" [rowHeight]="'auto'" [columnMode]="'force'"
      [limit]="page.limit" [offset]="page.offset" [count]="page.count" (page)="filter($event)"
      [ngClass]="{'is-loading-page' : dataLoading}">
      <ngx-datatable-column [resizeable]="false" [width]="300" [canAutoResize]="false">
        <ng-template let-column="column" ngx-datatable-header-template>
          Title
        </ng-template>
        <ng-template let-row="row" ngx-datatable-cell-template>
          <span *ngIf="row.shopifyData">
            <span *ngIf="row.shopifyData.title"><a
                href="https://{{user.domain}}/{{pageType}}/{{row.shopifyData.handle}}"
                target="_blank">{{row.shopifyData.title}}</a></span>
          </span>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column [resizeable]="false" [width]="200">
        <ng-template let-column="column" ngx-datatable-header-template>
          Scan Count
        </ng-template>
        <ng-template let-row="row" ngx-datatable-cell-template>
          <span>{{row.seoScanCount}}</span>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column [resizeable]="false" [canAutoResize]="true" [width]="150">
        <ng-template let-column="column" class="text-left" ngx-datatable-header-template>
          Seo Issues
        </ng-template>
        <ng-template let-row="row" ngx-datatable-cell-template>
          <span *ngIf="row.seoScan">
            <div class="issues" *ngIf="row.seoScan.errCount">
              <div class="issue" *ngIf="row.seoScan.errCount.error > 0 ">
                <span class="indicator risk1"></span>
                <span class="text">
                  <span>{{row.seoScan.errCount.error}}</span>
                  <span *ngIf="row.seoScan.errCount.error == 1 "> Error</span>
                  <span *ngIf="row.seoScan.errCount.error > 1 "> Errors</span>
                </span>
              </div>
              <div class="issue" *ngIf="row.seoScan.errCount.warning > 0 ">
                <span class="indicator risk2"></span>
                <span class="text">
                  <span>{{row.seoScan.errCount.warning}}</span>
                  <span *ngIf="row.seoScan.errCount.warning == 1 "> Warning</span>
                  <span *ngIf="row.seoScan.errCount.warning  > 1 "> Warnings</span>
                </span>
              </div>
            </div>
          </span>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column [resizeable]="false" [width]="150" [canAutoResize]="false">
        <ng-template let-column="column" ngx-datatable-header-template>
          Actions
        </ng-template>
        <ng-template let-row="row" ngx-datatable-cell-template>
          <div class="secondary-btn" *ngIf="row.seoScan">
            <button (click)="learnMoreOnIssue(row)">Details</button>
          </div>
          <div *ngIf="!row.seoScan">
            <span>Not scanned yet</span>
          </div>
        </ng-template>
      </ngx-datatable-column>

    </ngx-datatable>
  </div>
  <div class="no-data" *ngIf="products.length == 0 && !loading">
    <app-no-data></app-no-data>
  </div>
  <app-loading *ngIf="loading"></app-loading>
</div>

<div class="overlay" [ngClass]="{active: planError == true}">
  <div class="popup" *ngIf="planError == true">
    <h3>Upgrade Plan to countinue</h3>
    <a class="close" (click)="changeBoolean('planError',false);">&times;</a>
    <div class="content">
      You need to Upgrade your plan to continue using our app.
    </div>
    <div class="flex align-items-center justify-content-center">
      <button class="btn" [routerLink]="['/pricing']">
        <span>Goto Pricing</span>
      </button>
    </div>
  </div>
</div>