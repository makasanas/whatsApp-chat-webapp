<div class="product-list-content">
  <div class="loading-grid" *ngIf="loading">
    <app-loading></app-loading>
  </div>
  <div *ngIf="!loading">
    <div class="popup ">
      <div class="content">
        <div class="header">
          <h1>popup</h1>
          <div class="close">
            <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
              x="0px" y="0px" width="357px" height="357px" viewBox="0 0 357 357"
              style="enable-background:new 0 0 357 357;" xml:space="preserve">
              <g>
                <g id="close">
                  <polygon points="357,35.7 321.3,0 178.5,142.8 35.7,0 0,35.7 142.8,178.5 0,321.3 35.7,357 178.5,214.2 321.3,357 357,321.3 
                 214.2,178.5" />
                </g>
              </g>
            </svg>
          </div>
        </div>
        <div class="loading-grid">
          <app-loading></app-loading>
        </div>
        <div class="detail">
        </div>
      </div>
    </div>

    <div [formGroup]="filters">
      <div class="filters">
        <div class="filter">
          <select formControlName="collection_id">
            <option value="">Select collection</option>
            <option *ngFor="let collection of collections; let i = index" [value]="collection.id">{{collection.title}}
            </option>
          </select>
        </div>

        <div class="filter">
          <select formControlName="published_status">
            <option value="">Product Status</option>
            <option value="published">published</option>
            <option value="unpublished">unpublished</option>
          </select>
        </div>
        <div class="filter date">
          <div class="input-group">
            <input formControlName="created_at_min" class="form-control" placeholder="Product Created After" name="dp"
              ngbDatepicker #startdate="ngbDatepicker">
            <svg id="Layer_1" (click)="startdate.toggle()" style="enable-background:new 0 0 80 75;" version="1.1"
              viewBox="0 0 80 75" xml:space="preserve">
              <g id="Layer_2">
                <g id="Layer_3">
                  <path
                    d="M53.4,10.4V4.7h-3v5.7h-8.5V4.7h-3v5.7h-9.1V4.7h-3v5.7H5.4v59.9h69.1V10.4H53.4z M26.8,13.4V19h3v-5.7H39V19h3v-5.7h8.5    V19h3v-5.7h18.1v44.2H8.4V13.4H26.8z M8.4,67.3v-6.7h63.1v6.7L8.4,67.3z" />
                  <rect height="5.7" width="5.7" x="22.6" y="30" />
                  <rect height="5.7" width="5.7" x="37.1" y="30" />
                  <rect height="5.7" width="5.7" x="51.7" y="30" />
                  <rect height="5.7" width="5.7" x="22.6" y="44.6" />
                  <rect height="5.7" width="5.7" x="37.1" y="44.6" />
                  <rect height="5.7" width="5.7" x="51.7" y="44.6" />
                </g>
              </g>
            </svg>
          </div>
        </div>
        <div class="filter date">
          <div class="input-group">
            <input formControlName="created_at_max" class="form-control" placeholder="Product Created Before" name="dp"
              ngbDatepicker #enddate="ngbDatepicker">
            <svg id="Layer_1" (click)="enddate.toggle()" style="enable-background:new 0 0 80 75;" version="1.1"
              viewBox="0 0 80 75" xml:space="preserve">
              <g id="Layer_2">
                <g id="Layer_3">
                  <path
                    d="M53.4,10.4V4.7h-3v5.7h-8.5V4.7h-3v5.7h-9.1V4.7h-3v5.7H5.4v59.9h69.1V10.4H53.4z M26.8,13.4V19h3v-5.7H39V19h3v-5.7h8.5    V19h3v-5.7h18.1v44.2H8.4V13.4H26.8z M8.4,67.3v-6.7h63.1v6.7L8.4,67.3z" />
                  <rect height="5.7" width="5.7" x="22.6" y="30" />
                  <rect height="5.7" width="5.7" x="37.1" y="30" />
                  <rect height="5.7" width="5.7" x="51.7" y="30" />
                  <rect height="5.7" width="5.7" x="22.6" y="44.6" />
                  <rect height="5.7" width="5.7" x="37.1" y="44.6" />
                  <rect height="5.7" width="5.7" x="51.7" y="44.6" />
                </g>
              </g>
            </svg>
          </div>
        </div>
      </div>

      <div class="search-content">
        <div class="form-content">
          <input placeholder="Search Product with full title only work" formControlName="title" />
          <button class="btn" (click)="productlist=[]; filterProduct() ">
            <div *ngIf="!searchLoading">
              Search
            </div>
            <div *ngIf="searchLoading">
              <div class="loader"></div>
            </div>
          </button>
        </div>
      </div>

    </div>

    <div class="multi-select" *ngIf="selected.length > 0">
      <p>Total {{selected.length}} Product selected</p>
      <div class="btns">
        <div class="btn" (click)="submitInBulk()">Submit in Bulk</div>
        <div class="btn" (click)="updateInBulk()">Edit in Bulk</div>
        <div class="btn" (click)="deleteInBulk(selected)">Delete in Bulk</div>
      </div>
    </div>
    <div class="row-per-page">
      <p>Row per page</p>
      <select name="ipp" id="ipp" (change)="pageLimit()" [(ngModel)]="page.limit">
        <option>Items per page</option>
        <option [value]="2">10</option>
        <option [value]="25">25</option>
        <option [value]="50">50</option>
        <option [value]="100">100</option>
        <option [value]="250">250</option>
      </select>
    </div>

    <div class="table-responsive">
      <ngx-datatable class="material" [rows]="productlist" [rowClass]="getRowClass" [columns]="columns"
        [headerHeight]="50" [footerHeight]="50" [externalPaging]="true" [rowHeight]="'auto'" [columnMode]="'force'"
        [limit]="page.limit" [offset]="page.offset" [count]="page.count" (page)="getProduct($event, query)">
        <ngx-datatable-column [width]="70" [sortable]="false" [canAutoResize]="false" [draggable]="false"
          [resizeable]="false">
          <ng-template ngx-datatable-header-template>
            <input type="checkbox" [checked]="allSelected" (change)="selectAll($event.currentTarget.checked)" />
          </ng-template>
          <ng-template ngx-datatable-cell-template let-row="row" let-rowIndex="rowIndex">
            <input type="checkbox" [checked]="row.isSelected" (change)="onSelect($event, row, rowIndex)" />
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column [width]="70" [canAutoResize]="false" [resizeable]="false">
          <ng-template let-column="column" ngx-datatable-header-template>
          </ng-template>
          <ng-template let-row="row" ngx-datatable-cell-template>
            <img *ngIf="row.image" src={{row.image.src}} alt="!">
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column [resizeable]="false" [width]="300" [canAutoResize]="false">
          <ng-template let-column="column" ngx-datatable-header-template>
            Title
          </ng-template>
          <ng-template let-row="row" ngx-datatable-cell-template>
            <a [href]="'https://'+shopUrl+'/products/'+row.handle" target="_blank">{{row.title}}</a>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column [resizeable]="false">
          <ng-template let-column="column" ngx-datatable-header-template>
            Product type
          </ng-template>
          <ng-template let-row="row" ngx-datatable-cell-template>
            {{row.product_type}}
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column [resizeable]="false">
          <ng-template let-column="column" ngx-datatable-header-template>
            Status
          </ng-template>
          <ng-template let-row="row" ngx-datatable-cell-template>
            <p *ngIf="row.status">
              <span
                *ngIf="row.status.productStatus">{{row.status.productStatus.destinationStatuses[0].status | titlecase}}</span>
              <span *ngIf="row.status.errors">{{row.status.errors.message}}</span>
            </p>
            <p *ngIf="!row.status">Loading ...</p>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column [resizeable]="false" [width]="120" [canAutoResize]="false">
          <ng-template let-column="column" ngx-datatable-header-template>
            Action
          </ng-template>
          <ng-template let-row="row" ngx-datatable-cell-template>
            <div class="secondary-btn" *ngIf="row.status">
              <button *ngIf="row.status.errors" (click)="singleAdd(row);bulkType='Submit'">Submit</button>
              <button *ngIf="!row.status.errors" (click)="singleAdd(row);fixErrors(row);bulkType='Update'">Edit</button>
              <button *ngIf="!row.status.errors" (click)="deleteSingle(row)">Delete</button>
            </div>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-footer>
          <ng-template ngx-datatable-footer-template let-rowCount="rowCount" let-pageSize="pageSize"
            let-selectedCount="selectedCount" let-curPage="curPage" let-offset="offset" let-isVisible="isVisible">
            <div class="page-count">
              <span *ngIf="selectedMessage">
                Total {{selectedCount.toLocaleString()}} {{selectedMessage}} /
              </span>
              Total {{rowCount.toLocaleString()}} {{totalMessage}}
            </div>
            <div class="pagination">
              <p [ngClass]="!pagination.previous ? 'disabled' : '' "
                (click)="pagination.previous ? getProductByLink(pagination.previous) : false">Previous</p>
              <p [ngClass]="!pagination.next ? 'disabled' :''"
                (click)="pagination.next ? getProductByLink(pagination.next) : false">Next</p>
            </div>
          </ng-template>
        </ngx-datatable-footer>
      </ngx-datatable>
    </div>
  </div>
</div>